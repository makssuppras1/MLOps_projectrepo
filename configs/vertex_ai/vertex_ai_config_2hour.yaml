# Proper Vertex AI Custom Job Configuration
# 2-hour training experiment - maximum quality with full training time
# Training: Up to 2 hours, full dataset, using e2-standard-4
#
# ⚠️ BEFORE SUBMITTING: Run ./scripts/preflight_check.sh
# This ensures platform (linux/amd64), permissions, image region, and configs are correct.
scheduling:
  timeout: 7200s  # 2 hours (7200 seconds)

# Base output directory - CRITICAL: This sets AIP_MODEL_DIR environment variable
# Model will be saved to: gs://mlops_project_data_bucket1-europe-west1/experiments/2hour/trained_model.pt
# Vertex AI automatically sets AIP_MODEL_DIR to point to this location
baseOutputDirectory:
  outputUriPrefix: gs://mlops_project_data_bucket1-europe-west1/experiments/2hour

workerPoolSpecs:
  - machineSpec:
      machineType: e2-standard-4  # More common machine type for faster provisioning
    replicaCount: 1
    containerSpec:
      imageUri: europe-west1-docker.pkg.dev/dtumlops-484310/container-registry/train:latest
      env:
        - name: WANDB_API_KEY
          value: ${WANDB_API_KEY}  # Will be replaced by sed in Cloud Build or manually
        - name: WANDB_PROJECT
          value: "pname-arxiv-classifier"
      args:
        - "experiment=2hour"
    diskSpec:
      bootDiskType: pd-ssd
      bootDiskSizeGb: 100
